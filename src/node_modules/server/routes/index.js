import React from 'react'
import ReactDOMServer from 'react-dom/server'
import { Provider } from 'react-redux'
import { createStore } from 'redux'

import App from 'app/components/App'
import reducers, { setEvent, setEvents, setDates } from 'app/ducks'
import Html from 'app/helpers/Html'

export function get(req, res, next) {
  const db = req.app.get('db')
  return fetchData()
    .then(getStore)
    .then(renderPage)
    .then(page => res.send(page))
    .catch(next)
}

const fetchData = () => {
  return Promise.resolve({})
}

const getStore = (data) => {
  return { getState: () => (data) }
}

const renderPage = (store) => {
  return Html(
    ReactDOMServer.renderToString((
      <Provider store={store}>
        <App />
      </Provider>
    )),
    store.getState()
  )
}
